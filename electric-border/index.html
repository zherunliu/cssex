<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <title>electric-border</title>
  </head>
  <body>
    <main class="container">
      <div class="card">
        <div class="card__layer card__layer--main"></div>
        <div class="card__layer card__layer--glow-tight"></div>
        <div class="card__layer card__layer--glow-wide"></div>
        <div class="card__layer card__layer--overlay-primary"></div>
        <div class="card__layer card__layer--overlay-secondary"></div>
        <div class="card__layer card__layer--background-glow"></div>
        <div class="card__content">
          <h1>Hello, world</h1>
          <hr class="card__divider" />
          <p class="card__sender">From: Rico</p>
        </div>
      </div>
    </main>
    <svg width="0" height="0">
      <defs>
        <filter
          id="turbulent-displace"
          color-interpolation-filter="sRGB"
          x="-20%"
          y="-20%"
          width="140%"
          height="140%"
        >
          <!-- 柏林噪声算法 -->
          <!-- 垂直方向 -->
          <feTurbulence
            type="turbulence"
            baseFrequency="0.02"
            numOctaves="10"
            seed="1"
            result="verticalNoise"
          />
          <feOffset in="verticalNoise" result="animatedVertical_1">
            <animate
              id="animate-dy-1"
              attributeName="dy"
              values="270;0"
              dur="4s"
              repeatCount="indefinite"
            />
          </feOffset>
          <feOffset in="verticalNoise" result="animatedVertical_2">
            <animate
              id="animate-dy-2"
              attributeName="dy"
              values="0;-270"
              dur="4s"
              repeatCount="indefinite"
            />
          </feOffset>
          <feComposite
            in="animatedVertical_1"
            in2="animatedVertical_2"
            operator="over"
            result="seamlessVerticalNoise"
          />
          <!-- 水平方向 -->
          <feTurbulence
            type="turbulence"
            baseFrequency="0.02"
            numOctaves="10"
            seed="2"
            result="horizontalNoise"
          />
          <feOffset in="horizontalNoise" result="animatedHorizontal_1">
            <animate
              id="animate-dx-1"
              attributeName="dx"
              values="408;0"
              dur="4s"
              repeatCount="indefinite"
            />
          </feOffset>
          <feOffset in="horizontalNoise" result="animatedHorizontal_2">
            <animate
              id="animate-dx-2"
              attributeName="dx"
              values="0;-408"
              dur="4s"
              repeatCount="indefinite"
            />
          </feOffset>
          <feComposite
            in="animatedHorizontal_1"
            in2="animatedHorizontal_2"
            operator="over"
            result="seamlessHorizontalNoise"
          />
          <feBlend
            in="seamlessVerticalNoise"
            in2="seamlessHorizontalNoise"
            mode="color-dodge"
            result="finalBlendedNoise"
          />
          <feDisplacementMap
            in="SourceGraphic"
            in2="finalBlendedNoise"
            scale="30"
            xChannelSelector="R"
            yChannelSelector="B"
          />
        </filter>
      </defs>
    </svg>
    <script>
      function updateAnimationValues() {
        const card = document.querySelector(".card");
        if (!card) return;
        const PX_PER_SEC = 100;
        const SIZE_FACTOR = 1.4;
        const { width, height } = card.getBoundingClientRect();

        const filterHeight = height * SIZE_FACTOR;
        const filterWidth = width * SIZE_FACTOR;
        const durationY = (filterHeight / PX_PER_SEC).toFixed(2);
        const durationX = (filterWidth / PX_PER_SEC).toFixed(2);
        const animateDY1 = document.getElementById("animate-dy-1");
        const animateDY2 = document.getElementById("animate-dy-2");
        const animateDX1 = document.getElementById("animate-dx-1");
        const animateDX2 = document.getElementById("animate-dx-2");
        if (animateDY1) {
          animateDY1.setAttribute("values", `${filterHeight};0`);
          animateDY1.setAttribute("dur", `${durationY}s`);
        }
        if (animateDY2) {
          animateDY2.setAttribute("values", `0;-${filterHeight}`);
          animateDY2.setAttribute("dur", `${durationY}s`);
        }
        if (animateDX1) {
          animateDX1.setAttribute("values", `${filterWidth};0`);
          animateDX1.setAttribute("dur", `${durationX}s`);
        }
        if (animateDX2) {
          animateDX2.setAttribute("values", `0;-${filterWidth}`);
          animateDX2.setAttribute("dur", `${durationX}s`);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const card = document.querySelector(".card");
        if (!card) return;
        const resizeObserver = new ResizeObserver(() => {
          updateAnimationValues();
        });
        updateAnimationValues();
        resizeObserver.observe(card);
      });
    </script>
  </body>
</html>
